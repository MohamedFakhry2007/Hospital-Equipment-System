{% extends "base.html" %}

{% block title %}Training Management{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex align-items-center mb-4">
        <h1 class="page-title me-3 mb-0">Training Management</h1>
        <span class="badge bg-primary fs-6 px-3 py-2 rounded-pill shadow-sm">
            <i class="fas fa-users me-1"></i>
            <span id="totalEmployeeCount">{{ pagination.total if pagination else 0 }}</span> employees
        </span>
    </div>
    
    <!-- Search and Filter Row -->
    <!-- Search and Filter Row -->
    <div class="row mb-3 align-items-center">
        <div class="col-lg-8 col-md-12">
            <form method="GET" action="{{ url_for('training.list_trainings') }}" id="trainingListForm" class="row g-2">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" name="search" id="searchInput" class="form-control" placeholder="Search by name or ID..." value="{{ search }}">
                    </div>
                </div>
                <div class="col-md-3">
                    <select name="department" id="filterDepartment" class="form-select">
                        <option value="">All Departments</option>
                        {% for dept in departments %}
                            <option value="{{ dept }}" {% if selected_department == dept %}selected{% endif %}>{{ dept }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                     <select id="filterEmployeeId" name="employee_id" class="form-select">
                        <option value="">All Employees</option>
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <div class="col-md-2">
                    <select id="sortSelect" name="sort" class="form-select">
                        <option value="">Sort by...</option>
                        <option value="name">Name</option>
                        <option value="employee_id">Employee ID</option>
                        <option value="department">Department</option>
                        <option value="last_trained_date">Last Trained</option>
                        <option value="next_due_date">Next Due</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="col-lg-4 col-md-12 text-end mt-2 mt-lg-0">
            <button id="bulkDeleteBtn" class="btn btn-danger" style="display: none;">
                <i class="fas fa-trash"></i> Delete Selected (<span id="selectedCount">0</span>)
            </button>
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTrainingModal">
                <i class="fas fa-plus"></i> Add New Training
            </button>
        </div>
    </div>

    

    <!-- Training Records Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="trainingTable">
            <thead class="table-dark">
                <tr>
                    <th style="width: 3%;"><input type="checkbox" id="selectAll" title="Select all records"></th>
                    <th style="width: 5%;">#</th>
                    <th class="sortable" data-sort="employee_id">Employee ID <i class="fas fa-sort"></i></th>
                    <th class="sortable" data-sort="name">Name <i class="fas fa-sort"></i></th>
                    <th class="sortable" data-sort="department">Department <i class="fas fa-sort"></i></th>
                    <th>Assignments</th>
                    <th class="sortable" data-sort="training_percentage">Training % <i class="fas fa-sort"></i></th>
                    <th class="sortable" data-sort="last_trained_date">Last Trained <i class="fas fa-sort"></i></th>
                    <th class="sortable" data-sort="next_due_date">Next Due <i class="fas fa-sort"></i></th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for training in trainings %}
                    <tr id="training-row-{{ training.id }}" data-training-id="{{ training.id }}">
                        <td>{{ training.id }}</td>
                        <td>{{ training.employee_id }}</td>
                        <td>{{ training.name }}</td>
                        <td>{{ training.department }}</td>
                        <td>
                            {% if training.machine_trainer_assignments %}
                                {% for assignment in training.machine_trainer_assignments %}
                                    <span class="badge bg-info text-dark mb-1">
                                        {{ assignment.machine }}
                                        <small class="text-muted">({{ assignment.trainer }})</small>
                                    </span>
                                {% endfor %}
                            {% else %}
                                <span class="text-muted">No machines assigned</span>
                            {% endif %}
                        </td>
                        <td>{{ training.last_trained_date or 'N/A' }}</td>
                        <td>{{ training.next_due_date or 'N/A' }}</td>
                        <td>
                            {% set status = training.status|default('pending', true) %}
                            <span class="badge bg-{{ 'success' if status == 'completed' else 'warning' if status == 'in_progress' else 'danger' }}">
                                {{ status|title }}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('training.edit_training', training_id=training.id) }}" class="btn btn-sm btn-primary">Edit</a>
                            <form action="{{ url_for('training.delete_training', training_id=training.id) }}" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this item?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <!-- Pagination -->
        <nav aria-label="Training pagination" class="mt-4">
            <ul class="pagination justify-content-center">
                <!-- Pagination will be inserted here by JavaScript -->
            </ul>
        </nav>
    </div>
</div>


<!-- Add Training Modal -->
<div class="modal fade" id="addTrainingModal" tabindex="-1" aria-labelledby="addTrainingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTrainingModalLabel">Add New Training Record</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addTrainingForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="addEmployeeId" class="form-label">Employee ID <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addEmployeeId" name="employee_id" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="addName" class="form-label">Employee Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addName" name="name" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="addDepartment" class="form-label">Department</label>
                            <select class="form-select" id="addDepartment" name="department">
                                <option value="">Select Department</option>
                                {% for dept in departments %}
                                    <option value="{{ dept }}">{{ dept }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Machine Training Assignments</label>
                        <div id="addMachineAssignmentsContainer" class="machine-assignments-container border p-2" style="max-height: 300px; overflow-y: auto;">
                            <p class="text-muted text-center" id="addMachinePlaceholder">Select a department to see available machines.</p>
                            <!-- Machine assignments will be dynamically inserted here -->
                        </div>
                        <small class="form-text text-muted">Select machines and assign a trainer for each.</small>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="addLastTrainedDate" class="form-label">
                                <i class="fas fa-calendar-alt me-2 text-primary"></i>Last Trained Date
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-calendar-check text-primary"></i>
                                </span>
                                <input type="text" class="form-control border-start-0 modern-date-picker" 
                                       id="addLastTrainedDate" name="last_trained_date"
                                       placeholder="dd/mm/yyyy" autocomplete="off">
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="addNextDueDate" class="form-label">
                                <i class="fas fa-calendar-plus me-2 text-success"></i>Next Due Date
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-calendar-week text-success"></i>
                                </span>
                                <input type="text" class="form-control border-start-0 modern-date-picker" 
                                       id="addNextDueDate" name="next_due_date"
                                       placeholder="dd/mm/yyyy" autocomplete="off">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" form="addTrainingForm">Save Training</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Training Modal -->
<div class="modal fade" id="editTrainingModal" tabindex="-1" aria-labelledby="editTrainingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTrainingModalLabel">Edit Training Record</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editTrainingForm">
                    <input type="hidden" id="editTrainingId" name="id">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editEmployeeId" class="form-label">Employee ID <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editEmployeeId" name="employee_id" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editName" class="form-label">Employee Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editName" name="name" required>
                        </div>
                    </div>                     <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editDepartment" class="form-label">Department</label>
                            <select class="form-select" id="editDepartment" name="department">
                                <option value="">Select Department</option>
                                {% for dept in departments %}
                                    <option value="{{ dept }}">{{ dept }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Machine Training Assignments</label>
                        <div id="editMachineAssignmentsContainer" class="machine-assignments-container border p-2" style="max-height: 300px; overflow-y: auto;">
                            <p class="text-muted text-center" id="editMachinePlaceholder">Select a department to see available machines.</p>
                            <!-- Machine assignments will be dynamically inserted here -->
                        </div>
                        <small class="form-text text-muted">Select machines and assign a trainer for each.</small>
                    </div>
                     <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editLastTrainedDate" class="form-label">
                                <i class="fas fa-calendar-alt me-2 text-primary"></i>Last Trained Date
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-calendar-check text-primary"></i>
                                </span>
                                <input type="text" class="form-control border-start-0 modern-date-picker" 
                                       id="editLastTrainedDate" name="last_trained_date"
                                       placeholder="dd/mm/yyyy" autocomplete="off">
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editNextDueDate" class="form-label">
                                <i class="fas fa-calendar-plus me-2 text-success"></i>Next Due Date
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-calendar-week text-success"></i>
                                </span>
                                <input type="text" class="form-control border-start-0 modern-date-picker" 
                                       id="editNextDueDate" name="next_due_date"
                                       placeholder="dd/mm/yyyy" autocomplete="off">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" form="editTrainingForm">Save Changes</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block styles %}
{{ super() }}
<style>
/* Sortable column styles */
.sortable {
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    position: relative;
}

.sortable:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.sortable i {
    margin-left: 5px;
    opacity: 0.5;
}

.sortable.asc i:before {
    content: "\f0de"; /* fa-sort-up */
    opacity: 1;
}

.sortable.desc i:before {
    content: "\f0dd"; /* fa-sort-down */
    opacity: 1;
}

/* Control buttons styling */
.controls-row {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

/* Bulk delete button styling */
#bulkDeleteBtn {
    transition: all 0.3s ease;
}

/* Table row selection highlight */
.table tbody tr.selected {
    background-color: #e3f2fd !important;
}

/* Filter and search controls */
.form-select, .form-control {
    min-width: 150px;
}

/* Machine/Trainer styling */
.table td .machine-number {
    font-weight: 600 !important;
    color: #6c757d !important;
}

.table td .machine-name {
    font-weight: 500 !important;
    color: #212529 !important;
}

.table td .trainer-name {
    font-weight: bold !important;
    color: #dc3545 !important;
}

/* Additional specificity for trainer names */
.table tbody tr td .trainer-name,
.table tbody tr td span.trainer-name {
    font-weight: bold !important;
    color: #dc3545 !important;
}

/* Training percentage badge styling */
.training-percentage {
    font-size: 0.85rem !important;
    font-weight: 600 !important;
    padding: 0.5em 0.75em !important;
    border-radius: 0.5rem !important;
    min-width: 50px;
    text-align: center;
}

/* Employee count badge styling */
.badge.bg-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
    border: 2px solid rgba(255, 255, 255, 0.2);
    font-weight: 600;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    animation: pulse-glow 2s infinite;
}

.badge.bg-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4) !important;
}

@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
    }
    50% {
        box-shadow: 0 4px 20px rgba(0, 123, 255, 0.5);
    }
}

/* Responsive controls for smaller screens */
@media (max-width: 768px) {
    .col-md-auto {
        margin-bottom: 10px;
    }
    
    .form-select, .form-control {
        min-width: 120px;
    }
    
    .d-flex.align-items-center {
        flex-direction: column;
        align-items: flex-start !important;
    }
    
    .badge.bg-primary {
        margin-top: 10px;
        font-size: 0.9rem !important;
    }
}

/* Modern Date Picker Styles */
.modern-date-picker {
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    font-weight: 500;
}

.modern-date-picker:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    transform: translateY(-1px);
}

.input-group .input-group-text {
    border-radius: 0.5rem 0 0 0.5rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #ced4da;
    transition: all 0.3s ease;
}

.input-group:focus-within .input-group-text {
    border-color: #0d6efd;
    background: linear-gradient(135deg, #e7f1ff 0%, #cce7ff 100%);
}

.input-group .modern-date-picker {
    border-radius: 0 0.5rem 0.5rem 0;
}

/* Flatpickr customization */
.flatpickr-calendar {
    border-radius: 0.75rem !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15) !important;
    border: 1px solid #e9ecef !important;
}

.flatpickr-day {
    border-radius: 0.5rem !important;
    transition: all 0.2s ease !important;
}

.flatpickr-day:hover {
    background: #e7f1ff !important;
    border-color: #0d6efd !important;
    transform: scale(1.05) !important;
}

.flatpickr-day.selected {
    background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%) !important;
    border-color: #0d6efd !important;
    box-shadow: 0 2px 8px rgba(13, 110, 253, 0.3) !important;
}

.flatpickr-day.today {
    border-color: #fd7e14 !important;
    background: #fff3cd !important;
    color: #664d03 !important;
}

.flatpickr-months .flatpickr-month {
    background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%) !important;
    color: white !important;
    border-radius: 0.75rem 0.75rem 0 0 !important;
}

.flatpickr-current-month .flatpickr-monthDropdown-months,
.flatpickr-current-month .numInputWrapper {
    color: white !important;
}

.flatpickr-prev-month,
.flatpickr-next-month {
    color: white !important;
}

.flatpickr-prev-month:hover,
.flatpickr-next-month:hover {
    color: #cce7ff !important;
}
</style>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Initialize global variables with default values
window.devicesByDepartment = {};
window.trainers = [];
window.csrfToken = '';

// Set global variables from template data
(function() {
    try {
        // Get JSON strings from template variables
        const devicesByDepartmentJson = '{{ devices_by_department|tojson|safe }}';
        const trainersJson = '{{ trainers|tojson|safe }}';
        
        // Parse JSON data if not empty
        if (devicesByDepartmentJson) {
            window.devicesByDepartment = JSON.parse(devicesByDepartmentJson);
        }
        
        if (trainersJson) {
            window.trainers = JSON.parse(trainersJson);
        }
        
        // Set CSRF token
        const token = '{{ csrf_token() }}';
        if (token) {
            window.csrfToken = token;
        }
    } catch (error) {
        console.error('Error initializing template data:', error);
    }
})();

// Function to escape HTML strings to prevent XSS
function escapeHtml(unsafe) {
    if (!unsafe) return '';
    return unsafe
        .toString()
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

// Initialize the training page when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== DOM Content Loaded - Training Page ===');
    
    // Initialize the training page
    if (typeof initTrainingPage === 'function') {
        initTrainingPage();
    } else {
        console.error('initTrainingPage function not found');
        // Fallback to direct initialization
        setupEventListeners();
        fetchAndRenderTrainings(1);
    }
    
    // Set up delete button handlers
    const deleteButtons = document.querySelectorAll('.delete-training');
    const deleteForm = document.getElementById('deleteForm');
    const deleteModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('deleteModal'));
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const trainingId = this.getAttribute('data-id');
            deleteForm.action = `/training/${trainingId}/delete`;
            deleteModal.show();
        });
    });
    
    // Handle search form submission
    const searchForm = document.querySelector('form[data-training-list]');
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            // Remove empty parameters before submission
            const inputs = this.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (!input.value) {
                    input.disabled = true;
                }
            });
            // Submit the form
            this.submit();
        });
    }
});

// Generate machine assignments function
function generateMachineAssignments(department, containerId, existingAssignments) {
    // Handle default parameter for existingAssignments
    if (existingAssignments === undefined) {
        existingAssignments = [];
    }
    
    console.log('Generating machine assignments for department:', department, 'Container:', containerId);
    console.log('Available devicesByDepartment:', window.devicesByDepartment);
    
    const container = document.getElementById(containerId);
    if (!container) {
        console.error('Container not found:', containerId);
        return;
    }
    
    // Clear existing content
    container.innerHTML = '';
    
    // Get devices for the selected department
    const devices = window.devicesByDepartment[department] || [];
    
    if (devices.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No devices found for this department.</div>';
        return;
    }
    
    // Create a row for each device
    devices.forEach(function(device, index) {
        const row = document.createElement('div');
        row.className = 'row mb-2';
        
        // Find existing assignment for this device if any
        const existingAssignment = existingAssignments.find(function(a) { 
            return a.device_id === device.id; 
        });
        
        // Create elements directly instead of using innerHTML for better security
        const col1 = document.createElement('div');
        col1.className = 'col-md-5';
        
        const formCheck = document.createElement('div');
        formCheck.className = 'form-check';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'form-check-input device-checkbox';
        checkbox.id = 'device_' + device.id;
        checkbox.value = device.id;
        if (existingAssignment) {
            checkbox.checked = true;
        }
        
        const label = document.createElement('label');
        label.className = 'form-check-label';
        label.htmlFor = 'device_' + device.id;
        label.textContent = device.name + ' (' + (device.model_number || 'N/A') + ')';
        
        const col2 = document.createElement('div');
        col2.className = 'col-md-7';
        
        const hoursInput = document.createElement('input');
        hoursInput.type = 'number';
        hoursInput.className = 'form-control form-control-sm';
        hoursInput.name = 'hours_' + device.id;
        hoursInput.placeholder = 'Training hours';
        if (existingAssignment) {
            hoursInput.value = existingAssignment.hours_trained || '';
        } else {
            hoursInput.disabled = true;
        }
        
        // Build the DOM structure
        formCheck.appendChild(checkbox);
        formCheck.appendChild(label);
        col1.appendChild(formCheck);
        col2.appendChild(hoursInput);
        row.appendChild(col1);
        row.appendChild(col2);
        
        // Add event listener to enable/disable hours input based on checkbox
        checkbox.addEventListener('change', function() {
            hoursInput.disabled = !this.checked;
            if (!this.checked) {
                hoursInput.value = '';
            }
        });
        
        container.appendChild(row);
        
        // The event listener is already added above, so we don't need this duplicate code
    });
}

// Function to populate trainer dropdown
function populateTrainerDropdown(selectId, selectedTrainerId) {
    selectedTrainerId = selectedTrainerId || '';
    const select = document.getElementById(selectId);
    if (!select) return;
    
    // Clear existing options
    select.innerHTML = '';
    
    // Add default option
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Select Trainer...';
    select.appendChild(defaultOption);
    
    // Add trainer options
    window.trainers.forEach(function(trainer) {
        const option = document.createElement('option');
        option.value = trainer.id;
        option.textContent = trainer.name;
        option.selected = (trainer.id === selectedTrainerId);
        select.appendChild(option);
    });
}

// Function to handle department change in the form
function handleDepartmentChange(select, containerId) {
    const department = select.value;
    generateMachineAssignments(department, containerId);
}

// Initialize department change handlers for add form
const addDepartmentSelect = document.getElementById('addDepartment');
if (addDepartmentSelect) {
    addDepartmentSelect.addEventListener('change', function() {
        handleDepartmentChange(this, 'addMachineAssignmentsContainer');
    });
}

// Initialize department change handlers for edit form
const editDepartmentSelect = document.getElementById('editDepartment');
if (editDepartmentSelect) {
    editDepartmentSelect.addEventListener('change', function() {
        handleDepartmentChange(this, 'editMachineAssignmentsContainer');
    });
}

// Initialize trainer dropdowns when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    populateTrainerDropdown('trainer_id');
    populateTrainerDropdown('edit_trainer_id');
});

document.addEventListener('DOMContentLoaded', function() {
    console.log('=== DOM Content Loaded - Training Page ===');
    console.log('Available data:');
    console.log('- devicesByDepartment:', devicesByDepartment);
    console.log('- trainers:', trainers);
    
    // Simple event listeners like in machine_assignment.html
    const addDepartmentSelect = document.getElementById('addDepartment');
    const editDepartmentSelect = document.getElementById('editDepartment');

    // Add department change handler (same as working implementation)
    if (addDepartmentSelect) {
        console.log('Setting up Add department handler');
        addDepartmentSelect.addEventListener('change', function() {
            const selectedDepartment = this.value;
            console.log('Add department changed to:', selectedDepartment);
            generateMachineAssignments(selectedDepartment, 'addMachineAssignmentsContainer', []);
        });
    }

    // Edit department change handler (same as working implementation)
    if (editDepartmentSelect) {
        console.log('Setting up Edit department handler');
        editDepartmentSelect.addEventListener('change', function() {
            const selectedDepartment = this.value;
            console.log('Edit department changed to:', selectedDepartment);
            generateMachineAssignments(selectedDepartment, 'editMachineAssignmentsContainer', []);
        });
    }

    console.log('Event handlers setup complete');
    
    // Modern date pickers are automatically initialized by the shared module
    // Just ensure they refresh when modals are shown
    console.log('Training page: Modern date pickers will be handled by shared module');
});
</script>
<!-- Include training page specific JavaScript -->
<script src="{{ url_for('static', filename='js/training.js') }}" defer></script>
{% endblock %}
